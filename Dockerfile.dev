FROM node:20-slim AS base
RUN corepack enable
WORKDIR /app
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/shared/package.json ./packages/shared/
COPY packages/server/package.json ./packages/server/
COPY packages/client/package.json ./packages/client/

FROM base AS server
RUN pnpm install --frozen-lockfile
COPY packages/shared ./packages/shared
COPY packages/server ./packages/server
EXPOSE 3001

FROM base AS client
RUN pnpm install --frozen-lockfile
COPY packages/shared ./packages/shared
COPY packages/client ./packages/client
EXPOSE 5173
